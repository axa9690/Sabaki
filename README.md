# Sabaki Email — AI Job Inbox Labeling Agent (Gmail + LLM)

An AI-powered Gmail agent that **auto-labels job-application emails** into clear stages (APPLIED, ASSESSMENTS, IN_PROCESS, INTERVIEWS, REJECTED, OTP_SECURITY, etc.).  
Built with **Python**, **Gmail API (OAuth)**, **rule-based short-circuiting**, and **LLM + Pydantic validation** (Ollama local for v1).

---

## Why this project
When you’re applying to many jobs, the inbox becomes noise. This tool:
- Reads recent emails from a dedicated job-search Gmail account
- Classifies each email into a job stage
- Applies the correct Gmail label automatically
- Marks certain “low value” emails (e.g., APPLIED / REJECTED) as read so you don’t waste time

This is designed as a **real AI application**, not a simple API wrapper:
- Hybrid pipeline (fast rules + LLM fallback)
- Strict structured outputs (Pydantic)
- Safe retries when the model returns invalid JSON
- Gmail labeling + processed skipping for efficiency

---

## Current Features (v1)
### ✅ Job labels supported
- `APPLIED`
- `ASSESSMENTS`
- `IN_PROCESS`
- `INTERVIEWS`
- `REJECTED`
- `OTP_SECURITY` (one-time passcodes / verification codes)
- `RECOMMENDATIONS` (referrals, reference requests, “you were referred”)
- `JOB_ALERTS` (career portal alerts / job matches)
- `ADVERTISEMENTS` (non-job noise / promotions)

### ✅ Smart behavior
- **Rule short-circuit** for obvious patterns (fast + saves LLM calls)
- **LLM fallback** (Ollama) for ambiguous emails
- **Schema validation** using Pydantic (no random outputs)
- **Skip already processed emails** using a `PROCESSED` label
- **Mark as read** automatically for `APPLIED` and `REJECTED`

---

## Architecture (high-level)
1. Fetch recent Gmail email metadata/snippets
2. If email already has `PROCESSED` → skip
3. Run fast regex rules → label if confident
4. Else send to LLM → receive JSON → validate with Pydantic
5. Apply Gmail label + add `PROCESSED`
6. If label is APPLIED/REJECTED → mark as read

---

## Tech Stack
- Python 3.11
- Gmail API (OAuth 2.0)
- Ollama (local LLM for v1)
- Pydantic (structured outputs + validation)
- Docker-ready for future serverless deployment

---

## Setup (Local)
### 1) Create & activate venv
```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
```

### 2) Install Dependencies
```powershell
pip install -r requirements
```

### 3) Gmail OAuth setup
You must create a Google Cloud OAuth client and generate a token locally.
Place these locally (DO NOT commit them):
  secrets/gmail_oauth_client.json
  secrets/gmail_token.json (generated by auth script)
Run:
```
$env:PYTHONPATH="src"
python scripts/auth_gmail_local.py
```

Verify:
```
python scripts/gmail_profile_test.py
```


## Run the Agent
```
$env:PYTHONPATH="src"
python scripts/analyze_and_label_recent.py
```

Expected output:
 - Labels applied with the reason (rule vs LLM)
 - Summary with checked/labeled/skipped counts

## Configuration Notes
 - You can tune max emails / rules / labels inside the script and pipeline.
 - For speed + cost reduction, rule short-circuit runs before LLM.

## Safety
 - This project never commits secrets (tokens, OAuth client JSON, API keys).
 - Use a dedicated Gmail account for job applications (recommended).

## Roadmap
### v2 (production/serverless)
 - Gemini support (hosted model for deployment)
 - AWS Lambda deployment via Docker container image
 - Scheduled runs (EventBridge) or webhook-based trigger
 - Multi-account label mappings
 - Batch classification to reduce latency + cost

## Demo
### Terminal Output
<img width="2274" height="244" alt="image" src="https://github.com/user-attachments/assets/7c606fee-1381-43c2-9bf6-c1cd99fa11ec" />

### GMail Labels
<img width="2230" height="1051" alt="image" src="https://github.com/user-attachments/assets/41f234f6-ddce-4a11-bfc7-b647ebf62f51" />

## Author

#### Anand Manohar Agnihotram
AI Application Engineering | Python Full Stack | MS CS (UTA)
