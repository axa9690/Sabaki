# Sabaki — AI Job Inbox Labeling Agent (Gmail + LLM)

An AI-powered Gmail agent that **auto-labels job-application emails** into clear stages (APPLIED, ASSESSMENTS, IN_PROCESS, INTERVIEWS, REJECTED, OTP_SECURITY, etc.).  
Built with **Python**, **Gmail API (OAuth)**, **rule-based short-circuiting**, and **LLM + Pydantic validation** (Ollama local for v1).

<img width="2752" height="1536" alt="Gemini_Generated_Image_pa2e7npa2e7npa2e" src="https://github.com/user-attachments/assets/6904a49a-b5a3-418a-8f69-3e046b76b350" />


---

## Why This Project Matters

When you’re actively applying to jobs, your inbox quickly turns into noise. Sabaki solves this by acting as a **personal AI inbox agent** that:

- Reads recent emails from a dedicated job-search Gmail account
- Classifies each email into a clear job pipeline stage
- Applies the correct Gmail label automatically
- Marks low-value emails (e.g., APPLIED / REJECTED) as read so you focus only on what matters

This is not a toy script or a simple API wrapper — it is designed as a **real AI application** with reliability, cost control, and safety in mind.

### What Makes This a Real AI Agent

- **Hybrid pipeline**: fast regex rules first, LLM only when needed
- **Cost-aware design**: avoids unnecessary LLM calls
- **Strict structured outputs** using Pydantic (no hallucinated labels)
- **Safe retries** when model output is invalid
- **Stateful processing** using a PROCESSED label to avoid rework
- **HTML email normalization** before LLM inference to improve accuracy and performance

---

## Current Features (v1)
### ✅ Job labels supported
- `APPLIED`
- `ASSESSMENTS`
- `IN_PROCESS`
- `INTERVIEWS`
- `REJECTED`
- `OTP_SECURITY` (one-time passcodes / verification codes)
- `RECOMMENDATIONS` (referrals, reference requests, “you were referred”)
- `JOB_ALERTS` (career portal alerts / job matches)
- `ADVERTISEMENTS` (non-job noise / promotions)

### ✅ Smart behavior
- **Rule short-circuit** for obvious patterns (fast + saves LLM calls)
- **LLM fallback** (Ollama) for ambiguous emails
- **Schema validation** using Pydantic (no random outputs)
- **Skip already processed emails** using a `PROCESSED` label
- **Mark as read** automatically for `APPLIED` and `REJECTED`

✅ Reliability & Accuracy Improvements
- Two-stage email fetch (metadata first, full body only when required)
- HTML email body normalization before rule checks and LLM inference
- Truncated and cleaned prompts to prevent slow or unstable model calls
- Debug logging for OTHERS classifications to continuously improve rules

---

## Architecture (High-Level)

1. Fetch recent Gmail email metadata (subject, sender, snippet)
2. Skip emails already marked with PROCESSED
3. Run fast regex-based rules to classify obvious cases
4. Fetch and normalize full email body only for uncertain cases
5. Re-run rules on normalized content
6. Fall back to LLM classification when needed
7. Validate LLM output using Pydantic schema
8. Apply Gmail label + PROCESSED
9. Mark emails as read for APPLIED / REJECTED

<img width="1022" height="844" alt="Sabaki works like a personal assistant for my job inbox  - visual selection" src="https://github.com/user-attachments/assets/feffac4e-dd99-409e-bdd9-8fdcc6649f39" />

---

## Design Philosophy

Sabaki is built with the mindset of a production AI system:

- **Rules before models** for speed, cost, and determinism
- **LLMs as a reasoning fallback**, not a first step
- **Structured outputs over free-text generation**
- **Fail-safe defaults** (OTHERS + PROCESSED) instead of crashes
- **Extensible architecture** for cloud and serverless deployment

---

## Tech Stack

- Python 3.11
- Gmail API (OAuth 2.0)
- Ollama (local LLM inference for v1)
- Pydantic (structured output validation)
- Regex-based rules engine
- Docker-ready architecture (for future AWS Lambda deployment)

---

## Setup (Local)
### 1) Create & activate venv
```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
```

### 2) Install Dependencies
```powershell
pip install -r requirements
```

### 3) Gmail OAuth setup
You must create a Google Cloud OAuth client and generate a token locally.
Place these locally (DO NOT commit them):
  secrets/gmail_oauth_client.json
  secrets/gmail_token.json (generated by auth script)
Run:
```
$env:PYTHONPATH="src"
python scripts/auth_gmail_local.py
```

Verify:
```
python scripts/gmail_profile_test.py
```


## Run the Agent
```
$env:PYTHONPATH="src"
python scripts/analyze_and_label_recent.py
```

Expected output:
 - Labels applied with the reason (rule vs LLM)
 - Summary with checked/labeled/skipped counts

## Configuration Notes
 - You can tune max emails / rules / labels inside the script and pipeline.
 - For speed + cost reduction, rule short-circuit runs before LLM.

## Safety
 - This project never commits secrets (tokens, OAuth client JSON, API keys).
 - Use a dedicated Gmail account for job applications (recommended).

## Roadmap
### v2 (production/serverless)
 - Gemini support (hosted model for deployment)
 - AWS Lambda deployment via Docker container image
 - Scheduled runs (EventBridge) or webhook-based trigger
 - Multi-account label mappings
 - Batch classification to reduce latency + cost

## Demo
### Terminal Output
<img width="2274" height="244" alt="image" src="https://github.com/user-attachments/assets/7c606fee-1381-43c2-9bf6-c1cd99fa11ec" />

### GMail Labels
<img width="2230" height="1051" alt="image" src="https://github.com/user-attachments/assets/41f234f6-ddce-4a11-bfc7-b647ebf62f51" />


## Author

**Anand Manohar Agnihotram**  
AI Application Engineer | Python Full-Stack Developer  
MS in Computer Science — University of Texas at Arlington

This project represents my ability to design and build **end-to-end AI agents** that integrate LLMs into real workflows with reliability, structure, and cost awareness.

> Sabaki is a personal AI agent I actively use — and a foundation for building scalable, production-ready AI automation systems.
